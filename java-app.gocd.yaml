format_version: 9
environments:
  catalog-service-api-team:
    pipelines:
      - catalog-service-api-build
common:
  ## Environment Config test
  GROUP: &GROUP catalog-service-api-build
  SLACK_CHANNEL: &SLACK_CHANNEL catalog-service-api
  SLACK_CHANNEL_TYPE: &SLACK_CHANNEL_TYPE Channel # Channel, User, Text

  ## GoCD Agent
  RESOURCE_BUILDER: &RESOURCE_BUILDER trivy

  ## Material Config
  APP_REPO_DIR: &APP_REPO_DIR catalog-service-api
  APP_REPO: &APP_REPO
    git: git@github.com:centraldigital/catalog-service-api.git
    branch: master
    destination: *APP_REPO_DIR
    shallow_clone: false
    auto_update: true

  ## Parameter Config
  # project config
  IMAGE_BU_NAME: &IMAGE_BU_NAME common
  PROJECT_NAME: &PROJECT_NAME catalog-service-api

  ## Job Config
  NOTI_SUCCESS: &NOTI_SUCCESS
    - plugin:
        configuration:
          id: slack.task
          version: '2.0'
        options:
          Message: >-
            *Success:* $GO_PIPELINE_NAME
            *Version:* $GO_PIPELINE_LABEL
            <$GO_SERVER_URL/pipelines/value_stream_map/$GO_PIPELINE_NAME/$GO_PIPELINE_COUNTER|[Pipeline]>
          Channel: *SLACK_CHANNEL
          ChannelType: *SLACK_CHANNEL_TYPE
          DisplayName: $GO_PIPELINE_NAME
          ColorType: Good
          IconOrEmoji: ':+1'
        run_if: passed
  NOTI_FAIL: &NOTI_FAIL
    - plugin:
        configuration:
          id: slack.task
          version: '2.0'
        options:
          Message: >-
            *Failed:* $GO_JOB_NAME
            *Version:* $GO_PIPELINE_LABEL
            <$GO_SERVER_URL/tab/build/detail/$GO_PIPELINE_NAME/$GO_PIPELINE_COUNTER/$GO_STAGE_NAME/$GO_STAGE_COUNTER/$GO_JOB_NAME|[Pipeline]>
          Channel: *SLACK_CHANNEL
          ChannelType: *SLACK_CHANNEL_TYPE
          DisplayName: $GO_PIPELINE_NAME
          ColorType: Danger
          IconOrEmoji: ':alert:'
        run_if: failed
